% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/count_presences.R
\name{count_presences_auth}
\alias{count_presences_auth}
\title{Reproducible presence counts via GBIF downloads (authenticated)}
\usage{
count_presences_auth(
  species,
  shapefile = NULL,
  country = NULL,
  year = c(1999L, as.integer(format(Sys.Date(), "\%Y"))),
  restrict_to_species = TRUE,
  verbose = TRUE
)
}
\arguments{
\item{species}{A data frame/data.table/tibble with columns \code{family}, \code{genus}, \code{species}.}

\item{shapefile}{Path to a vector file readable by \code{terra::vect()}.
If provided (and \code{country} is \code{NULL}), its MBR is used as the GBIF
\code{geometry} filter via \code{\link{wkt_rect_ccw}}. Mutually exclusive with \code{country}.}

\item{country}{Two-letter ISO country code (e.g., \code{"DK"}). Ignored if \code{shapefile} is provided.
Mutually exclusive with \code{shapefile}.}

\item{year}{Integer vector \code{c(start, end)} with the year range (inclusive). Default is
\code{c(1999, current_year)}.}

\item{restrict_to_species}{Logical; if \code{TRUE} (default), the download is restricted to your
species by GBIF \code{taxonKey} (resolved via \code{rgbif::name_backbone()}). If \code{FALSE},
the download uses only area/time filters and species are filtered locally afterwards.}

\item{verbose}{Logical; if \code{TRUE}, prints progress messages.}
}
\value{
A \code{data.table} with columns \code{family}, \code{genus}, \code{species}, \code{N}.
}
\description{
Submits an authenticated GBIF Occurrence Download restricted by country/geometry
and year (optionally restricted to your species via GBIF taxon keys), waits for
completion, imports the result, and summarizes counts per species locally.
This is the \strong{robust} and reproducible approach recommended for larger jobs.
}
\details{
Count presences robustly using the GBIF Occurrence Download API (auth required)
}
\section{Credentials}{

Requires the environment variables \code{GBIF_USER}, \code{GBIF_PWD}, \code{GBIF_EMAIL}.
A convenient place to define them is your \code{~/.Renviron}.
}

\examples{
\dontrun{
# Set GBIF creds in ~/.Renviron:
# GBIF_USER=youruser
# GBIF_PWD=yourpassword
# GBIF_EMAIL=you@example.org

f_species <- system.file("ex/Species_List.csv", package = "SpeciesPoolR")
shp       <- system.file("ex/Aarhus.shp",      package = "SpeciesPoolR")
sp        <- SpeciesPoolR::get_data(f_species)
clean     <- SpeciesPoolR::Clean_Taxa(sp$Species)

out <- count_presences_auth(
  species   = clean,
  shapefile = shp,
  year      = c(1999, as.integer(format(Sys.Date(), "\%Y"))),
  restrict_to_species = TRUE,
  verbose   = TRUE
)
head(out)
}

}
\seealso{
\code{\link{count_presences_simple}}, \code{\link{count_presences}}, \code{\link{wkt_rect_ccw}}

Other GBIF helpers: 
\code{\link{count_presences}()},
\code{\link{count_presences_simple}()}
}
\concept{GBIF helpers}
