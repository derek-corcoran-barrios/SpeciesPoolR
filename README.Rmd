---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  warning = FALSE,
  message = FALSE,
  error = FALSE
)
```

# SpeciesPoolR

<!-- badges: start -->
[![R-CMD-check](https://github.com/derek-corcoran-barrios/SpeciesPoolR/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/derek-corcoran-barrios/SpeciesPoolR/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

The goal of the `SpeciesPoolR` package is to generate potential species pools and their summary metrics in a spatial way, to install the package you can do it from github:

```{r, eval=FALSE}
#install.packages("remotes")
remotes::install_github("derek-corcoran-barrios/SpeciesPoolR")
```

No you can load the package

```{r setup}
library(SpeciesPoolR)
```

# Using SpeciesPoolR manually

## Importing and downloading species presences

If you are going to use each of the functions of the `SpeciesPoolR` manually and sequentially the first step would  be to read in a species list from either a csv or an xlsx file, for that you can use the `get_data` function. You can include filtering in a `dplyr` filter style in order to subset your dataset in the following way:

```{r ReadInData}
f <- system.file("ex/Species_List.csv", package="SpeciesPoolR")
filtered_data <- get_data(
   file = f,
   filter = quote(Kingdom == "Plantae" & 
                    Class == "Magnoliopsida" & 
                    Family == "Fabaceae")
)
```

This will generate the following dataset that we can use on subsequently to count the species presences and download the species presences.

```{r tablespecies, echo = F}
knitr::kable(filtered_data, caption = "Species that will be used to generate species pools")
```

After that we do a taxonomic harmonization to ensure that the species we use have the names recognized in the GBIF taxonomic backbone:

```{r CleanSpecies}
Clean_Species <- SpeciesPoolR::Clean_Taxa(filtered_data$Species)
```

This will return a very similar dataframe, but it will ensure that the names are recognized by GBIF, this results in the following data.frame

```{r cleantable, echo=FALSE}
knitr::kable(Clean_Species, caption = "Taxonomicallty harmonized dataset")
```

After that, and specially if you want to calculate rarity it is important that you get from gbif the number of presences of each of this species in your study area, for that we use the function `count_presences` here you can select either by country or use a shapefile to limit your search, here is an example of the usage of this function for Denmark only, it is very important that the dataframe you feed to this function has a column called species.

```{r countdenmark}
library(data.table)
# Assuming Clean_Species is your data frame
Count_DK <- count_presences(Clean_Species, country = "DK")
```

this results in the following table:

```{r tableCountDenmark}
knitr::kable(Count_DK, caption = "Counts of presences for the different species within Denmark")
```

Or if we used only Aarhus commune:

```{r AarhusCount}
shp <- system.file("ex/Aarhus.shp", package="SpeciesPoolR")

Count_Aarhus <- count_presences(Clean_Species, shapefile = shp)
```

Which results in the following data.frame

```{r tableCountAarhus, echo = FALSE}
knitr::kable(Count_Aarhus, caption = "Counts of presences for the different species within Aarhus commune")
```
